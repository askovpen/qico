# 
# $Id: Makefile.in,v 1.8 2001/01/08 16:09:03 lev Exp $
#

prefix  = @prefix@
exec_prefix = @exec_prefix@
BINDIR  = @bindir@
SBINDIR  = @sbindir@

CONFIG = @CONFIG@
INSTALL = @INSTALL@
VERSION = @VERSION@

DIRS    = src

DIST    = qico-$(VERSION).tar.gz
DIST_DIRS = src stuff
DIST_FILES = stuff/* src/*.[chlyx] src/*.in src/*.awk \
Changes FAQ LICENSE README *.in acconfig.h configure install-sh \
qico.conf.sample mkinstalldirs qico.spec
DIST_EXCLUDE = src/tcpp.c

DOCS = Changes FAQ LICENSE README stuff qico.conf.sample

AUTOFILES = Makefile config.h configure qico.spec config.cache config.h.in config.log config.status

###############################################################################
all: autogenerate
	for d in ${DIRS}; do (cd $$d && echo $$d && ${MAKE} $@) || exit; done;

clean:
	for d in ${DIRS}; do (cd $$d && ${MAKE} $@) || exit; done;
	rm -f qico-$(VERSION).tar.gz config.cache *~

full-clean: clean
	for d in ${DIRS}; do (cd $$d && ${MAKE} $@) || exit; done;
	rm -f $(AUTOFILES)

install: install-bin
install-strip: install-bin-strip

install-bin: autogenerate
	./mkinstalldirs $(BINDIR)
	./mkinstalldirs $(SBINDIR)
	for d in ${DIRS}; do (cd $$d && ${MAKE} prefix=$(prefix) install) || exit; done;
install-bin-strip: autogenerate install-docs
	./mkinstalldirs $(BINDIR)
	./mkinstalldirs $(SBINDIR)
	for d in ${DIRS}; do (cd $$d && ${MAKE} prefix=$(prefix) install-strip) || exit; done;

install-conf:
	$(INSTALL) -m 644 qico.conf.sample $(CONFIG).sample

install-docs:
	./mkinstalldirs $(prefix)/doc/qico-$(VERSION)
	cp -Rf $(DOCS) $(prefix)/doc/qico-$(VERSION)

autogenerate: configure config.h.in Makefile config.h

configure: configure.in
	@rm -rf configure
	autoconf

config.h.in: acconfig.h
	@rm -rf config.h.in
	autoheader

Makefile: configure Makefile.in
	@echo "+====================================================+"
	@echo "|  configure or Makefile.in is newer, than Makefile  |"
	@echo "|   Please, run ./configure with needed parameters   |"
	@echo "+====================================================+"
	@exit 1

config.h: config.h.in
	@echo "+================================================+"
	@echo "|      config.h.in is newer, than config.h       |"
	@echo "| Please, run ./configure with needed parameters |"
	@echo "+================================================+"
	@exit 1

dist: clean config.h.in configure 
	mkdir qico-$(VERSION)
	for i in $(DIST_DIRS); do mkdir qico-$(VERSION)/$$i; done
	for i in $(DIST_FILES); do cp -f $$i qico-$(VERSION)/$$i; done
	for i in $(DIST_EXCLUDE); do rm -rf qico-$(VERSION)/$$i; done
	tar -chf - qico-$(VERSION) | gzip -f -9 > $(DIST)
	rm -rf qico-$(VERSION)
