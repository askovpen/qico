# 
# $Id: Makefile.in,v 1.12 2001/03/10 19:50:15 lev Exp $
#

prefix  = @prefix@
exec_prefix = @exec_prefix@
BINDIR  = @bindir@
SBINDIR  = @sbindir@

CONFIG = @CONFIG@
INSTALL = @INSTALL@
VERSION = @VERSION@

DIRS    = src

DIST    = qico-$(VERSION).tar.gz
DIST_DIRS = src stuff
DIST_FILES = stuff/* src/*.[chlyx] src/*.in src/*.awk \
	Changes FAQ LICENSE README *.in acconfig.h configure install-sh \
	qico.conf.sample mkinstalldirs qico.spec
DIST_EXCLUDE = src/tcpp.c

DOCS = Changes FAQ LICENSE README stuff qico.conf.sample

AUTOFILES = Makefile config.h configure qico.spec config.h.in \
	config.log config.status config.cache stamp-h stamp-h.in

###############################################################################
all: config.h Makefile
	for d in ${DIRS}; do (cd $$d && echo $$d && ${MAKE} $@) || exit; done;

clean:
	for d in ${DIRS}; do (cd $$d && ${MAKE} $@) || exit; done;
	rm -f qico-$(VERSION).tar.gz *~ 

full-clean: clean
	for d in ${DIRS}; do (cd $$d && ${MAKE} $@) || exit; done;
	rm -f $(AUTOFILES)

install: install-bin
install-strip: install-bin-strip

install-bin:
	./mkinstalldirs $(BINDIR)
	./mkinstalldirs $(SBINDIR)
	for d in ${DIRS}; do (cd $$d && ${MAKE} prefix=$(prefix) install) || exit; done;
install-bin-strip: install-docs
	./mkinstalldirs $(BINDIR)
	./mkinstalldirs $(SBINDIR)
	for d in ${DIRS}; do (cd $$d && ${MAKE} prefix=$(prefix) install-strip) || exit; done;

install-conf:
	$(INSTALL) -m 644 qico.conf.sample $(CONFIG).sample

install-docs:
	./mkinstalldirs $(prefix)/doc/qico-$(VERSION)
	cp -Rf $(DOCS) $(prefix)/doc/qico-$(VERSION)

configure: configure.in
	@rm -rf configure
	autoconf

config.h.in: stamp-h.in
stamp-h.in: configure.in acconfig.h
	autoheader
	@echo timestamp > stamp-h.in


config.h: stamp-h
stamp-h: config.h.in config.status
	./config.status

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck

dist: config.h.in configure clean
	mkdir qico-$(VERSION)
	for i in $(DIST_DIRS); do mkdir qico-$(VERSION)/$$i; done
	for i in $(DIST_FILES); do cp -f $$i qico-$(VERSION)/$$i; done
	for i in $(DIST_EXCLUDE); do rm -rf qico-$(VERSION)/$$i; done
	tar -chf - qico-$(VERSION) | gzip -f -9 > $(DIST)
	rm -rf qico-$(VERSION)
